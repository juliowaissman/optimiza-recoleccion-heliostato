<pre class="code">
<span class="srcline"><span class="lineno"><a href="94,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T58U3">con_p</span>, <span class="var type1" id="S3T59U4">P_a</span>] = simulador_rayos(<span class="var type1" id="S4T7U7">pared</span>, <span class="var type1" id="S5T8U8">N</span>, <span class="var type1" id="S6T9U9">Pp_1</span>, <span class="var type1" id="S7T9U10">rayo1</span>, <span class="var type1" id="S8T6U11">ct</span>, <span class="var type1" id="S9T2U12">radio</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="94,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo" id="T2:U9"><span class="var type1" id="S10T2U15">c2</span> = <span class="mxinfo" id="T2:U11">size(<span class="var type1" id="S6T9U18">Pp_1</span>,1)</span></span>; <span class="comment">%number of rays entering the receptor</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% number of tubes + number of walls</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T58:U13"><span class="var type1" id="S2T58U22">con_p</span> = <span class="mxinfo" id="T58:U15">zeros(<span class="mxinfo" id="T2:U16">1</span>,(<span class="mxinfo" id="T2:U17">(size(<span class="var type1" id="S4T7U32">pared</span>,1)-1)+size(<span class="var type1" id="S8T6U37">ct</span>,1)</span>))</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="94,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% matrix used further to asign x,y,z values for the impact position, </span></span></span>
<span class="srcline"><span class="lineno"><a href="94,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% and tell which tube or wall that corresponds to</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T59:U20"><span class="var type1" id="S3T59U41">P_a</span> = <span class="mxinfo" id="T59:U22">zeros(<span class="mxinfo" id="T2:U23"><span class="var type1" id="S10T2U44">c2</span></span>,<span class="mxinfo" id="T2:U25">4</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="94,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,12" id="srcline12">12</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S13T2U48">b</span> = <span class="mxinfo" id="T2:U27">1</span>:<span class="var type1" id="S10T2U51">c2</span> <span class="comment">%revisamos todos los rayos</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo" id="T10:U29"><span class="var type1" id="S14T10U54">P_e</span> = <span class="mxinfo" id="T10:U31"><span class="var type1" id="S6T9U56">Pp_1</span>(<span class="var type1" id="S13T2U57">b</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo" id="T10:U34"><span class="var type1" id="S15T10U61">rayo</span> = <span class="mxinfo" id="T10:U36"><span class="var type1" id="S7T9U63">rayo1</span>(<span class="var type1" id="S13T2U64">b</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo" id="T2:U39"><span class="var type1" id="S16T2U68">p_i</span> = <span class="mxinfo" id="T2:U41">6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo" id="T3:U42"><span class="var type1" id="S17T3U72">absv</span> = <span class="mxinfo" id="T3:U44">false(1)</span></span>; <span class="comment">%false(1)=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,17" id="srcline17">17</a></span><span class="line">    <span class="keyword">while</span> (<span class="mxinfo" id="T3:U45"><span class="var type1" id="S17T3U79">absv</span>==<span class="mxinfo" id="T2:U47">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="94,18" id="srcline18">18</a></span><span class="line">        <span class="comment">%revisamos en que pared intersecta el rayo</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,19" id="srcline19">19</a></span><span class="line">        <span class="mxinfo" id="T2:U48">[<span class="var type1" id="S16T2U84">p_i</span>, <span class="var type1" id="S19T61U85">Nrefl</span>, <span class="var type1" id="S14T10U86">P_e</span>] = <span class="fcn" id="F340N5:B88">impactos</span>(<span class="var type1" id="S15T10U89">rayo</span>, <span class="var type1" id="S16T2U90">p_i</span>, <span class="var type1" id="S14T10U91">P_e</span>, <span class="var type1" id="S4T7U92">pared</span>, <span class="var type1" id="S5T8U93">N</span>, <span class="var type1" id="S8T6U94">ct</span>, <span class="var type1" id="S9T2U95">radio</span>)</span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="94,20" id="srcline20">20</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="94,21" id="srcline21">21</a></span><span class="line">        <span class="comment">%el termino de en medio es para paredes con reflectancia 0.7</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,22" id="srcline22">22</a></span><span class="line">        <span class="keyword">if</span>  <span class="mxinfo" id="T3:U59"><span class="var type1" id="S16T2U101">p_i</span>==<span class="mxinfo" id="T2:U61">6</span></span> || (<span class="mxinfo" id="T3:U62"><span class="var type1" id="S16T2U106">p_i</span>&lt;<span class="mxinfo" id="T2:U64">6</span></span> &amp;&amp; <span class="mxinfo" id="T3:U65"><span class="mxinfo" id="T2:U66">rand</span> &lt; <span class="mxinfo" id="T2:U67">0.3</span></span>) || (<span class="mxinfo" id="T3:U68"><span class="var type1" id="S16T2U115">p_i</span>&gt;<span class="mxinfo" id="T2:U70">6</span></span> &amp;&amp; <span class="mxinfo" id="T3:U71"><span class="mxinfo" id="T2:U72">rand</span> &lt; <span class="mxinfo" id="T2:U73">0.6</span></span>)   </span></span>
<span class="srcline"><span class="lineno"><a href="94,23" id="srcline23">23</a></span><span class="line">            <span class="mxinfo" id="T2:U74"><span class="mxinfo" id="T2:U75"><span class="var type1" id="S2T58U124">con_p</span>(<span class="var type1" id="S16T2U125">p_i</span>)</span> = <span class="mxinfo" id="T2:U78"><span class="mxinfo" id="T2:U79"><span class="var type1" id="S2T58U128">con_p</span>(<span class="var type1" id="S16T2U129">p_i</span>)</span>+<span class="mxinfo" id="T2:U82">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,24" id="srcline24">24</a></span><span class="line">            <span class="mxinfo" id="T91:U83"><span class="mxinfo" id="T91:U84"><span class="var type1" id="S3T59U134">P_a</span>(<span class="var type1" id="S13T2U135">b</span>,:)</span> = <span class="mxinfo" id="T91:U87">[<span class="var type1" id="S14T10U139">P_e</span>, <span class="var type1" id="S16T2U140">p_i</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,25" id="srcline25">25</a></span><span class="line">            <span class="mxinfo" id="T3:U90"><span class="var type1" id="S17T3U143">absv</span> = <span class="mxinfo" id="T3:U92">true(1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="94,26" id="srcline26">26</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,27" id="srcline27">27</a></span><span class="line">            <span class="comment">%si el rayo no fue absorbido, se refleja</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,28" id="srcline28">28</a></span><span class="line">           <span class="mxinfo" id="T10:U93">[<span class="var type1" id="S15T10U151">rayo</span>] = <span class="mxinfo" id="T10:U95"><span class="fcn" id="F384N6:B153">reflejado</span>(<span class="var type1" id="S15T10U154">rayo</span>, <span class="var type1" id="S19T61U155">Nrefl</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="94,29" id="srcline29">29</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,30" id="srcline30">30</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,31" id="srcline31">31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,32" id="srcline32">32</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="94,33" id="srcline33">33</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U98"><span class="mxinfo" id="T2:U99"><span class="var type1" id="S10T2U159">c2</span></span> ~= <span class="mxinfo" id="T2:U101">sum(<span class="var type1" id="S2T58U162">con_p</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="94,34" id="srcline34">34</a></span><span class="line">    error(<span class="string">'Los rayos que entran deben de ser igual a los rayos que se absorben'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="94,35" id="srcline35">35</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="94,37" id="srcline37">37</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="94,38" id="srcline38">38</a></span><span class="line"></span></span>
</pre>
