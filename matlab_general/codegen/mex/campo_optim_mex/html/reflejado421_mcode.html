<pre class="code">
<span class="srcline"><span class="lineno"><a href="92,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T10U3">rayo</span>] = reflejado(<span class="mxinfo" id="T10:U2"><span class="mxinfo" id="T10:U3"><span class="var type1" id="S2T10U6">rayo</span></span></span>, <span class="var type1" id="S3T10U7">Ni</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="92,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="92,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo" id="T10:U6"><span class="var type1" id="S2T10U10">rayo</span> = <span class="mxinfo" id="T10:U8"><span class="mxinfo" id="T10:U9"><span class="mxinfo" id="T2:U10">2</span>*(<span class="mxinfo" id="T10:U11"><span class="mxinfo" id="T2:U12">dot(<span class="mxinfo" id="T10:U13">-<span class="var type1" id="S2T10U19">rayo</span></span>,<span class="var type1" id="S3T10U20">Ni</span>)</span>.*<span class="var type1" id="S3T10U21">Ni</span></span>)</span>+<span class="var type1" id="S2T10U22">rayo</span></span></span>; <span class="comment">%rayo reflejado</span></span></span>
<span class="srcline"><span class="lineno"><a href="92,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo" id="T2:U18"><span class="var type1" id="S5T2U25">ba</span>=<span class="mxinfo" id="T2:U20">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="92,6" id="srcline6"> 6</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U21"><span class="mxinfo" id="T2:U22">rand</span> &lt; <span class="mxinfo" id="T2:U23">0.5</span></span> &amp;&amp; <span class="var type1" id="S5T2U35">ba</span> == 1</span></span>
<span class="srcline"><span class="lineno"><a href="92,7" id="srcline7"> 7</a></span><span class="line">    <span class="comment">%error para los rayos</span></span></span>
<span class="srcline"><span class="lineno"><a href="92,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo" id="T2:U25"><span class="var type1" id="S7T2U39">sig_slr</span> = <span class="mxinfo" id="T2:U27">0.0</span></span>; <span class="comment">%[slope]</span></span></span>
<span class="srcline"><span class="lineno"><a href="92,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo" id="T2:U28"><span class="var type1" id="S8T2U43">sig_spr</span> = <span class="mxinfo" id="T2:U30">0.003</span></span>; <span class="comment">%[speculacion] 0.003</span></span></span>
<span class="srcline"><span class="lineno"><a href="92,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo" id="T2:U31"><span class="var type1" id="S9T2U47">sigr</span> = <span class="mxinfo" id="T2:U33">sqrt(4*<span class="var type1" id="S7T2U54">sig_slr</span>^2+<span class="var type1" id="S8T2U57">sig_spr</span>^2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="92,12" id="srcline12">12</a></span><span class="line">    <span class="comment">%angulos de inclinaci[on y rotacion de los rayos debido al error sig</span></span></span>
<span class="srcline"><span class="lineno"><a href="92,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo" id="T2:U36"><span class="var type1" id="S11T2U61">teta_r1</span> =(<span class="mxinfo" id="T2:U38">sqrt(<span class="mxinfo" id="T2:U39"><span class="mxinfo" id="T2:U40">-2*<span class="var type1" id="S9T2U70">sigr</span>^2</span>*<span class="mxinfo" id="T2:U42">log(<span class="mxinfo" id="T2:U43"><span class="mxinfo" id="T2:U44">1</span>-<span class="mxinfo" id="T2:U45">rand</span></span>)</span></span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo" id="T2:U46"><span class="var type1" id="S13T2U80">phi_r1</span> = <span class="mxinfo" id="T2:U48"><span class="mxinfo" id="T2:U49"><span class="mxinfo" id="T2:U50">rand</span>*<span class="mxinfo" id="T2:U51">2</span></span>*<span class="mxinfo" id="T2:U52">pi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="92,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo" id="T10:U53"><span class="var type1" id="S15T10U90">z1</span> = <span class="mxinfo" id="T10:U55">[0,0,1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo" id="T10:U56"><span class="var type1" id="S16T10U98">thnor</span> = <span class="mxinfo" id="T10:U58">cross(<span class="mxinfo" id="T10:U59"><span class="var type1" id="S15T10U101">z1</span></span>,<span class="var type1" id="S2T10U102">rayo</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo" id="T10:U62"><span class="var type1" id="S16T10U105">thnor</span> = <span class="mxinfo" id="T10:U64"><span class="var type1" id="S16T10U107">thnor</span>/<span class="mxinfo" id="T2:U66">norm(<span class="var type1" id="S16T10U110">thnor</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo" id="T10:U68"><span class="var type1" id="S19T10U113">shnor</span> = <span class="mxinfo" id="T10:U70">cross(<span class="var type1" id="S2T10U116">rayo</span>,<span class="var type1" id="S16T10U117">thnor</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo" id="T10:U73"><span class="var type1" id="S19T10U120">shnor</span> = <span class="mxinfo" id="T10:U75"><span class="var type1" id="S19T10U122">shnor</span>/<span class="mxinfo" id="T2:U77">norm(<span class="var type1" id="S19T10U125">shnor</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="92,22" id="srcline22">22</a></span><span class="line">    <span class="comment">%rayo generado con los angulos teta y phi</span></span></span>
<span class="srcline"><span class="lineno"><a href="92,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo" id="T10:U79"><span class="var type1" id="S20T10U128">rayito</span> = <span class="mxinfo" id="T10:U81"><span class="mxinfo" id="T10:U82"><span class="mxinfo" id="T10:U83"><span class="mxinfo" id="T2:U84"><span class="mxinfo" id="T2:U85">sin(<span class="var type1" id="S11T2U135">teta_r1</span>)</span>.*<span class="mxinfo" id="T2:U87">sin(<span class="var type1" id="S13T2U138">phi_r1</span>)</span></span>*<span class="var type1" id="S16T10U139">thnor</span></span> + <span class="mxinfo" id="T10:U90"><span class="mxinfo" id="T2:U91"><span class="mxinfo" id="T2:U92">sin(<span class="var type1" id="S11T2U144">teta_r1</span>)</span>.*<span class="mxinfo" id="T2:U94">cos(<span class="var type1" id="S13T2U147">phi_r1</span>)</span></span>*<span class="var type1" id="S19T10U148">shnor</span></span></span> + <span class="mxinfo" id="T10:U97"><span class="mxinfo" id="T2:U98">cos(<span class="var type1" id="S11T2U152">teta_r1</span>)</span>*<span class="var type1" id="S2T10U153">rayo</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo" id="T10:U101"><span class="var type1" id="S2T10U156">rayo</span> = <span class="mxinfo" id="T10:U103"><span class="var type1" id="S20T10U158">rayito</span>/<span class="mxinfo" id="T2:U105">norm(<span class="var type1" id="S20T10U161">rayito</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="92,25" id="srcline25">25</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="92,26" id="srcline26">26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="92,27" id="srcline27">27</a></span><span class="line"></span></span>
</pre>
