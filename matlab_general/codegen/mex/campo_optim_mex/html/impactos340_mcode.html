<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">p_i</span>, <span class="var type1" id="S3T62U4">Nrefl</span>, <span class="var type1" id="S4T10U5">P_e_new</span>] = impactos(<span class="var type1" id="S5T10U8">rayo</span>, <span class="var type1" id="S6T2U9">p_i1</span>, <span class="var type1" id="S7T10U10">P_e</span>, <span class="var type1" id="S8T7U11">pared</span>, <span class="var type1" id="S9T8U12">N</span>, <span class="var type1" id="S10T6U13">ct</span>, <span class="var type1" id="S11T2U14">radio</span>)   </span></span>
<span class="srcline"><span class="lineno"><a href="80,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% valor para que el rayo (por redondeo) no pegue en esquinas de la caja, </span></span></span>
<span class="srcline"><span class="lineno"><a href="80,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% ni se vaya de paso (por cuestiones de redondeo)</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo" id="T2:U11"><span class="var type1" id="S12T2U17">a1</span> = <span class="mxinfo" id="T2:U13">0.999</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="80,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T34:U14"><span class="var type1" id="S13T34U21">numerador</span> = <span class="mxinfo" id="T34:U16">dot(<span class="mxinfo" id="T27:U17"><span class="mxinfo" id="T27:U18"><span class="var type1" id="S8T7U26">pared</span>(<span class="mxinfo" id="T88:U20"><span class="mxinfo" id="T2:U21">2</span>:<span class="mxinfo" id="T2:U22">7</span></span>, <span class="mxinfo" id="T10:U23"><span class="mxinfo" id="T2:U24">1</span>:<span class="mxinfo" id="T2:U25">3</span></span>)</span> - <span class="mxinfo" id="T27:U26">repmat(<span class="var type1" id="S7T10U35">P_e</span>, 6, 1)</span></span>, <span class="mxinfo" id="T27:U28"><span class="var type1" id="S9T8U39">N</span>(<span class="mxinfo" id="T88:U30"><span class="mxinfo" id="T2:U31">2</span>:<span class="mxinfo" id="T2:U32">7</span></span>,:)</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T34:U33"><span class="var type1" id="S16T34U47">denominador</span> = <span class="mxinfo" id="T34:U35">dot( <span class="mxinfo" id="T27:U36">repmat(<span class="var type1" id="S5T10U52">rayo</span>, 6, 1)</span>, <span class="mxinfo" id="T27:U38"><span class="var type1" id="S9T8U56">N</span>(<span class="mxinfo" id="T88:U40"><span class="mxinfo" id="T2:U41">2</span>:<span class="mxinfo" id="T2:U42">7</span></span>,:)</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,10" id="srcline10">10</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U43">any(<span class="mxinfo" id="T21:U44"><span class="var type1" id="S16T34U67">denominador</span> == <span class="mxinfo" id="T2:U46">0</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,11" id="srcline11">11</a></span><span class="line">    error(<span class="string">'El denominador es cero'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="80,12" id="srcline12">12</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T34:U47"><span class="var type1" id="S19T34U75">d</span> = <span class="mxinfo" id="T34:U49"><span class="mxinfo" id="T34:U50"><span class="mxinfo" id="T2:U51"><span class="var type1" id="S12T2U78">a1</span></span> * <span class="var type1" id="S13T34U79">numerador</span></span> ./ <span class="var type1" id="S16T34U80">denominador</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T89:U55"><span class="mxinfo" id="T89:U56"><span class="var type1" id="S19T34U84">d</span>(<span class="mxinfo" id="T21:U58"><span class="var type1" id="S19T34U86">d</span>&lt;<span class="mxinfo" id="T2:U60">0</span></span>)</span> = <span class="mxinfo" id="T2:U61">1e20</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,16" id="srcline16">16</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U62"><span class="var type1" id="S6T2U92">p_i1</span> &lt; <span class="mxinfo" id="T2:U64">7</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="80,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo" id="T2:U65"><span class="mxinfo" id="T2:U66"><span class="var type1" id="S19T34U97">d</span>(<span class="var type1" id="S6T2U98">p_i1</span>)</span> = <span class="mxinfo" id="T2:U69">1e20</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,18" id="srcline18">18</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo" id="T2:U70">[<span class="var type1" id="S20T2U103">d_i</span>, <span class="var type1" id="S2T2U104">p_i</span>] = min(<span class="var type1" id="S19T34U107">d</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo" id="T62:U74"><span class="var type1" id="S3T62U110">Nrefl</span> = <span class="mxinfo" id="T10:U76"><span class="var type1" id="S9T8U112">N</span>(<span class="mxinfo" id="T2:U78"><span class="var type1" id="S2T2U114">p_i</span> + <span class="mxinfo" id="T2:U80">1</span></span>, :)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo" id="T10:U81"><span class="var type1" id="S4T10U119">P_e_new</span> = <span class="mxinfo" id="T10:U83"><span class="var type1" id="S7T10U121">P_e</span> + <span class="mxinfo" id="T10:U85"><span class="var type1" id="S20T2U123">d_i</span>*<span class="var type1" id="S5T10U124">rayo</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo" id="T6:U88"><span class="var type1" id="S22T6U127">A</span> = <span class="mxinfo" id="T6:U90"><span class="mxinfo" id="T6:U91"><span class="var type1" id="S10T6U130">ct</span>(:,<span class="mxinfo" id="T29:U93"><span class="mxinfo" id="T2:U94">1</span>:<span class="mxinfo" id="T2:U95">2</span></span>)</span> - <span class="mxinfo" id="T6:U96">repmat(<span class="mxinfo" id="T29:U97"><span class="var type1" id="S7T10U138">P_e</span>(<span class="mxinfo" id="T29:U99"><span class="mxinfo" id="T2:U100">1</span>:<span class="mxinfo" id="T2:U101">2</span></span>)</span>,size(<span class="var type1" id="S10T6U144">ct</span>,1),1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo" id="T6:U103"><span class="var type1" id="S24T6U149">B</span> = <span class="mxinfo" id="T6:U105">repmat(<span class="mxinfo" id="T29:U106"><span class="var type1" id="S5T10U153">rayo</span>(<span class="mxinfo" id="T29:U108"><span class="mxinfo" id="T2:U109">1</span>:<span class="mxinfo" id="T2:U110">2</span></span>)</span>,size(<span class="var type1" id="S10T6U159">ct</span>,1),1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T2:U112"><span class="var type1" id="S25T2U164">normBsquare</span> = (<span class="mxinfo" id="T2:U114"><span class="mxinfo" id="T2:U115"><span class="mxinfo" id="T2:U116"><span class="var type1" id="S5T10U169">rayo</span>(<span class="mxinfo" id="T2:U118">1</span>)</span>^2</span> + <span class="mxinfo" id="T2:U119"><span class="mxinfo" id="T2:U120"><span class="var type1" id="S5T10U174">rayo</span>(<span class="mxinfo" id="T2:U122">2</span>)</span>^2</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T2:U123"><span class="var type1" id="S26T2U179">normB</span> = <span class="mxinfo" id="T2:U125">sqrt(<span class="var type1" id="S25T2U182">normBsquare</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T41:U127"><span class="var type1" id="S28T41U185">dotA</span> = <span class="mxinfo" id="T41:U129">dot(<span class="var type1" id="S22T6U188">A</span>,<span class="var type1" id="S22T6U189">A</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T41:U132"><span class="var type1" id="S29T41U193">b</span> = <span class="mxinfo" id="T41:U134">sqrt(<span class="mxinfo" id="T41:U135">abs(<span class="mxinfo" id="T41:U136"><span class="var type1" id="S28T41U199">dotA</span> - <span class="mxinfo" id="T41:U138"><span class="mxinfo" id="T41:U139"><span class="mxinfo" id="T41:U140">dot(<span class="var type1" id="S22T6U204">A</span>,<span class="var type1" id="S24T6U205">B</span>,2)</span>.^2</span> / <span class="var type1" id="S25T2U208">normBsquare</span></span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,31" id="srcline31">31</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U144"><span class="var type1" id="S6T2U212">p_i1</span> &gt; <span class="mxinfo" id="T2:U146">6</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="80,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo" id="T2:U147"><span class="mxinfo" id="T2:U148"><span class="var type1" id="S29T41U217">b</span>(<span class="mxinfo" id="T2:U150"><span class="var type1" id="S6T2U219">p_i1</span>-<span class="mxinfo" id="T2:U152">6</span></span>)</span> = <span class="mxinfo" id="T2:U153">1e20</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,33" id="srcline33">33</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,35" id="srcline35">35</a></span><span class="line"><span class="keyword">if</span> isempty(<span class="mxinfo" id="T66:U154">find(<span class="mxinfo" id="T40:U155"><span class="var type1" id="S29T41U229">b</span> &lt;= <span class="var type1" id="S11T2U230">radio</span></span>, 1)</span>)    </span></span>
<span class="srcline"><span class="lineno"><a href="80,36" id="srcline36">36</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,37" id="srcline37">37</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo" id="T63:U158"><span class="var type1" id="S33T63U236">ind</span> = <span class="mxinfo" id="T63:U160">find(<span class="mxinfo" id="T40:U161"><span class="var type1" id="S29T41U240">b</span>&lt;=<span class="var type1" id="S11T2U241">radio</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo" id="T63:U164"><span class="var type1" id="S34T63U244">a</span> = <span class="mxinfo" id="T63:U166">sqrt(<span class="mxinfo" id="T63:U167"><span class="mxinfo" id="T74:U168">repmat(<span class="mxinfo" id="T2:U169"><span class="var type1" id="S11T2U251">radio</span>^2</span>,<span class="mxinfo" id="T29:U171">size(<span class="var type1" id="S33T63U255">ind</span>)</span>)</span>-<span class="mxinfo" id="T63:U173"><span class="mxinfo" id="T63:U174"><span class="var type1" id="S29T41U258">b</span>(<span class="var type1" id="S33T63U259">ind</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo" id="T63:U177"><span class="var type1" id="S35T63U263">ri</span>= (<span class="mxinfo" id="T63:U179"><span class="mxinfo" id="T63:U180"><span class="mxinfo" id="T63:U181">dot(<span class="mxinfo" id="T73:U182"><span class="var type1" id="S22T6U270">A</span>(<span class="var type1" id="S33T63U271">ind</span>,:)</span>, <span class="mxinfo" id="T73:U185">repmat(<span class="mxinfo" id="T29:U186"><span class="var type1" id="S5T10U276">rayo</span>(<span class="mxinfo" id="T29:U188"><span class="mxinfo" id="T2:U189">1</span>:<span class="mxinfo" id="T2:U190">2</span></span>)</span>,<span class="mxinfo" id="T29:U191">size(<span class="var type1" id="S33T63U282">ind</span>)</span>)</span>,2)</span> ./ <span class="mxinfo" id="T74:U193">repmat(<span class="var type1" id="S26T2U286">normB</span>,<span class="mxinfo" id="T29:U195">size(<span class="var type1" id="S33T63U289">ind</span>)</span>)</span></span> - <span class="var type1" id="S34T63U290">a</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T63:U198"><span class="mxinfo" id="T63:U199"><span class="var type1" id="S35T63U294">ri</span>(<span class="mxinfo" id="T75:U201"><span class="var type1" id="S35T63U296">ri</span>&lt;<span class="mxinfo" id="T2:U203">0</span></span>)</span>=<span class="mxinfo" id="T2:U204">1e20</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo" id="T2:U205">[<span class="var type1" id="S36T2U302">dt</span>, <span class="var type1" id="S37T2U303">ind2</span>] = min(<span class="var type1" id="S35T63U306">ri</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo" id="T2:U209"><span class="var type1" id="S38T2U309">t_i</span> = <span class="mxinfo" id="T2:U211"><span class="var type1" id="S33T63U311">ind</span>(<span class="var type1" id="S37T2U312">ind2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,44" id="srcline44">44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,45" id="srcline45">45</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U214"><span class="var type1" id="S36T2U316">dt</span> &lt; <span class="var type1" id="S20T2U317">d_i</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="80,46" id="srcline46">46</a></span><span class="line">        <span class="mxinfo" id="T2:U217"><span class="var type1" id="S20T2U320">d_i</span> = <span class="var type1" id="S36T2U321">dt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,47" id="srcline47">47</a></span><span class="line">        <span class="mxinfo" id="T2:U220"><span class="var type1" id="S2T2U324">p_i</span> = <span class="mxinfo" id="T2:U222"><span class="var type1" id="S38T2U326">t_i</span> + <span class="mxinfo" id="T2:U224">6</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,48" id="srcline48">48</a></span><span class="line">        <span class="mxinfo" id="T10:U225"><span class="var type1" id="S4T10U330">P_e_new</span> = <span class="mxinfo" id="T10:U227"><span class="var type1" id="S7T10U332">P_e</span> + <span class="mxinfo" id="T10:U229"><span class="var type1" id="S5T10U334">rayo</span>*<span class="var type1" id="S20T2U335">d_i</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,49" id="srcline49">49</a></span><span class="line">        <span class="mxinfo" id="T62:U232"><span class="var type1" id="S3T62U338">Nrefl</span> = <span class="mxinfo" id="T29:U234"><span class="mxinfo" id="T29:U235"><span class="var type1" id="S4T10U341">P_e_new</span>(<span class="mxinfo" id="T2:U237">1</span>,<span class="mxinfo" id="T29:U238"><span class="mxinfo" id="T2:U239">1</span>:<span class="mxinfo" id="T2:U240">2</span></span>)</span>-<span class="mxinfo" id="T29:U241"><span class="var type1" id="S10T6U347">ct</span>(<span class="var type1" id="S38T2U348">t_i</span>,<span class="mxinfo" id="T29:U244"><span class="mxinfo" id="T2:U245">1</span>:<span class="mxinfo" id="T2:U246">2</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,50" id="srcline50">50</a></span><span class="line">        <span class="mxinfo" id="T62:U247"><span class="var type1" id="S3T62U354">Nrefl</span> = <span class="mxinfo" id="T61:U249">[<span class="mxinfo" id="T76:U250"><span class="var type1" id="S3T62U358">Nrefl</span>/<span class="mxinfo" id="T2:U252">norm(<span class="var type1" id="S3T62U361">Nrefl</span>)</span></span>,<span class="mxinfo" id="T2:U254">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,51" id="srcline51">51</a></span><span class="line">    <span class="keyword">end</span>   </span></span>
<span class="srcline"><span class="lineno"><a href="80,52" id="srcline52">52</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,53" id="srcline53">53</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,54" id="srcline54">54</a></span><span class="line"></span></span>
</pre>
